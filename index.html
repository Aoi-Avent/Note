<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>water_</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    font-family: 'Hiragino Mincho Pro', 'ヒラギノ明朝 Pro', 'Times New Roman', serif;
  }
  body {
    background: #fff;
    color: #111;
  }
  #title {
    font-family: 'Hiragino Kaku Gothic ProN','ヒラギノ角ゴ ProN W6','Yu Gothic','游ゴシック',sans-serif;
    font-size: 2em;
    font-weight: bold;
    text-align: left;
    width: 70%;
    margin: 1em auto 0 auto;
    padding: 0 2em;
  }
  #display {
    font-size: 1.4em;
    line-height: 3.2em;
    white-space: pre-wrap;
    border: none;
    padding: 1em 2em;
    width: 70%;
    margin: 2em auto;
    min-height: 120px;
    max-height: 80vh;
    overflow-y: auto;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
  }
  #inputArea {
    width: 70%;
    margin: 2em auto;
    display: flex;
    flex-direction: column;
  }
  textarea {
    font-size: 1em;
    line-height: 1.5em;
    padding: 1em;
    resize: vertical;
    min-height: 100px;
  }
  button {
    margin-top: 1em;
    padding: 0.8em;
    font-size: 1em;
    cursor: pointer;
  }
</style>
</head>
<body>

<div id="inputArea">
  <input type="text" id="titleInput" placeholder="タイトルを入力">
  <textarea id="textInput" placeholder="本文を入力"></textarea>
  <button id="startBtn">表示開始</button>
</div>

<h1 id="title"></h1>
<div id="display"></div>

<script>
  const titleElem = document.getElementById('title');
  const display = document.getElementById('display');
  const startBtn = document.getElementById('startBtn');
  const titleInput = document.getElementById('titleInput');
  const textInput = document.getElementById('textInput');

  let autoScroll = true;

  display.addEventListener('scroll', () => {
    const atBottom = display.scrollHeight - display.scrollTop <= display.clientHeight + 5;
    autoScroll = atBottom;
  });

  startBtn.addEventListener('click', () => {
    const titleText = titleInput.value.trim();
    const bodyText = textInput.value.trim();
    if (!titleText && !bodyText) return;
    document.getElementById('inputArea').style.display = 'none';
    setTimeout(() => {
      showTextOneByOneTitle(titleText, () => {
        setTimeout(() => {
          showTextOneByOne(bodyText);
        }, 1000);
      });
    }, 1000);
  });

  function showTextOneByOneTitle(text, callback) {
    let index = 0;
    titleElem.textContent = '';
    function nextChar() {
      if (index < text.length) {
        titleElem.textContent += text.charAt(index);
        index++;
        setTimeout(nextChar, 130);
      } else if (callback) {
        callback();
      }
    }
    nextChar();
  }

  let currentText = '';
  let index = 0;

  function showTextOneByOne(text) {
    currentText = text;
    index = 0;
    display.textContent = '';
    showNextChar();
  }

  function showNextChar() {
    if (index < currentText.length) {
      const char = currentText.charAt(index);
      display.textContent += char;
      index++;

      if (autoScroll) display.scrollTop = display.scrollHeight;

      let delay = 95;
      if (char === '\n') delay = 800;
      else if (char === '。') delay = 1000;
      else if (char === '、' || char === '」' || char === '？' || char === '　' || char === ' ') delay = 600;

      setTimeout(showNextChar, delay);
    }
  }
</script>
</body>
</html>
